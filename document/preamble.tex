% cSpell:disable

\usepackage{style/buthesis}
\usepackage[utf8]{inputenc}

\usepackage[usenames,dvipsnames]{xcolor}
\usepackage[
	lambda,
	advantage,
	operators,
	sets,
	landau,
	probability,
	notions,
	logic,
	ff,
	mm,
	primitives,
	events,
	complexity,
	asymptotics,
	keys
]{cryptocode}
\usepackage{appendix}
\usepackage{adjustbox}
\usepackage[ruled]{algorithm}
\usepackage{algorithmicx}
\usepackage[noend]{algpseudocode}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{subcaption}
\usepackage{graphicx}
\usepackage{balance}
\usepackage{diagbox}
\usepackage{mathtools}
\usepackage{nicefrac}
\usepackage{booktabs}
\usepackage{multirow}
\usepackage{bm}
\usepackage{interval}
\usepackage{rotating}
\definecolor{BrightRed}{RGB}{204, 0, 0}
\definecolor{DarkRed}{RGB}{102, 0, 0}
\definecolor{MidRed}{RGB}{143, 0, 0}
\usepackage[
	colorlinks = true,
	linkcolor = DarkRed,
	urlcolor = MidRed,
	citecolor = BrightRed,
]{hyperref}
\usepackage[noabbrev,capitalise]{cleveref} % must be loaded after hyperref

\AtBeginEnvironment{appendices}{\crefalias{chapter}{appendix}}

\usepackage{color}
\usepackage{colortbl}
\usepackage{amsthm}
\usepackage{caption}
\usepackage[all]{nowidow}
\usepackage{hyphenat}
\usepackage[inline]{enumitem}
\usepackage[binary-units]{siunitx}
\usepackage[mathscr]{eucal}
\usepackage{longtable}
\usepackage{makecell}
\usepackage{threeparttable}
\usepackage{textcomp}
\usepackage{array}
\usepackage{calc}

\hyphenation{
	Shrink-wrap
	Shma-ti-kov
	SIG-SAC
	SIG-MOD
}

\sisetup{
	group-minimum-digits = 4,
	per-mode = symbol
}

\usepackage[
	backend=biber,
	style=alphabetic,
	giveninits=true,
	sorting=ydnt,
	maxbibnames=1000,
	maxalphanames=4
]{biblatex}

\bibliography{bibfile}

\renewcommand*{\mkbibnamegiven}[1]{%
	\ifitemannotation{highlight}
	{\textbf{#1}}
	{#1}
}

\renewcommand*{\mkbibnamefamily}[1]{%
	\ifitemannotation{highlight}
	{\textbf{#1}}
	{#1}
}

\graphicspath{{./graphics/}}

\ifdefined\draft%
	% https://www.overleaf.com/learn/latex/Inserting_Images#Generating_high-res_and_low-res_images
	\usepackage{epstopdf}
	\epstopdfDeclareGraphicsRule{.pdf}{png}{.png}{convert #1 \OutputFile}
	\DeclareGraphicsExtensions{.png,.pdf}
\fi

\usepackage[
	acronym,
	nonumberlist,
	nopostdot,
	nogroupskip
]{glossaries}
\renewcommand*{\glsclearpage}{}
\renewcommand*{\acronymname}{List of Acronyms}

\newglossarystyle{gloTable}
{%
	\newlength\aglslong%
	\settowidth\aglslong{\widthof{\textbf{CCP-ODB}}}

	\newlength\aglsleft%
	\setlength{\aglsleft}{\dimexpr\aglslong+0.1em\relax}

	\newlength\aglsright%
	\setlength{\aglsright}{\widthof{Health Insurance Portability and Accountability Act}}

	\newlength\aglscenter%
	\setlength{\aglscenter}{\dimexpr\linewidth-\aglsright-\aglsleft\relax}

	\renewenvironment{theglossary}%
	{
		\begin{center}
			\begin{longtable}{
				>{\raggedright}p{\aglsleft}
				p{\aglscenter}
				>{\raggedright}p{\aglsright}
			}
	}%
	{
			\end{longtable}
		\end{center}
	}%
	% no group headings:
	\renewcommand*{\glsgroupheading}[1]{}%
	% main (level 0) entries displayed in a row
	\renewcommand{\glossentry}[2]{%
		\glsentryitem{##1}\glstarget{##1}{\textbf{\glossentryname{##1}}} & \dotfill & \glossentrydesc{##1} \tabularnewline%
	}%
	% sub-entries (same as main)
	\renewcommand{\subglossentry}[3]{\glossentry{##2}{##3}}%
	% blank row between groups if nogroupskip=false
	\ifglsnogroupskip%
		\renewcommand*{\glsgroupskip}{}%
	\else
		\renewcommand*{\glsgroupskip}{ & & \tabularnewline}%
	\fi
}
\setglossarystyle{gloTable}

\renewcommand*{\glsclearpage}{}
\makeglossaries%
\glsaddall%

\newcommand{\crypte}{Crypt$\epsilon$}
\newcommand{\epsolute}{\ensuremath{\mathcal{E}}p\-so\-lu\-te}

\newcommand{\record}{\ensuremath{r}}
\newcommand{\recordID}{\ensuremath{\record^\mathsf{ID}}}
\newcommand{\recordIDPrime}{\ensuremath{{}^\mathsf{ID}\record^\prime}}
\newcommand{\querySet}{\ensuremath{\mathcal{Q}}}
\newcommand{\queryKey}{\ensuremath{K}}

\newcommand{\domainSize}{\ensuremath{N}}
\newcommand{\dataSize}{\ensuremath{n}}
\newcommand{\oramsNumber}{\ensuremath{m}}

\newcommand{\user}{\ensuremath{\mathscr{U}}}
\newcommand{\client}{\ensuremath{\mathscr{C}}}
\newcommand{\server}{\ensuremath{\mathscr{S}}}

\newcommand{\protocol}{\ensuremath{\Pi}}
\newcommand{\protocolSetup}{\ensuremath{\protocol_{\mathsf{setup}}}}
\newcommand{\protocolQuery}{\ensuremath{\protocol_{\mathsf{query}}}}
\newcommand{\protocolNoGamma}{\ensuremath{\protocol_{\mathsf{no-}\gamma}}}
\newcommand{\protocolGamma}{\ensuremath{\protocol_\gamma}}

\newcommand{\searchKey}{\textsf{SK}}
\newcommand{\searchKeyDomain}{\ensuremath{\mathcal{X}}}

\newcommand{\serverDS}{\ensuremath{\mathcal{DS}}}
\newcommand{\indexI}{\ensuremath{\mathcal{I}}}
\newcommand{\database}{\ensuremath{\mathcal{D}}}
\newcommand{\databaseDef}{\ensuremath{\database = \allowbreak \{(\record_1, \allowbreak \recordID_1, \allowbreak \searchKey_1), \allowbreak \ldots, \allowbreak (\record_\dataSize, \allowbreak \recordID_\dataSize, \allowbreak \searchKey_\dataSize)\}}}
\newcommand{\fanout}{\ensuremath{k}}

\newcommand{\oram}{\ensuremath{\textsc{ORAM}}}
\newcommand{\oramProgram}{\ensuremath{\mathbf{y}}}
\newcommand{\oramRead}{\ensuremath{\mathbf{r}}}
\newcommand{\oramWrite}{\ensuremath{\mathbf{w}}}

\newcommand{\efficiencyCoefficient}{\ensuremath{a_1}}
\newcommand{\efficiencyOffset}{\ensuremath{a_2}}

\DeclareDocumentCommand{\algo}{ m g }{%
	{%
		\textsc{#1}%
		\IfNoValueF{#2}{\ensuremath{\left( #2 \right)}}%
	}%
}

\DeclareDocumentCommand{\query}{ g g }{%
	{%
		\IfValueTF{#2}%
			{\ensuremath{q_{\interval{#1}{#2}}}}%
			{
				\IfValueTF{#1}%
					{\ensuremath{q_{#1}}}%
					{\ensuremath{q}}
			}%
	}%
}

\newcommand{\adversary}{\ensuremath{\mathcal{A}}}
\newcommand{\leakage}[1]{\ensuremath{\mathcal{L}_{\textsf{#1}}}}
\renewcommand{\simulator}{\textsc{Sim}}
\DeclareDocumentCommand{\view}{ g g }{%
	{%
		\IfValueTF{#2}%
			{\ensuremath{\algo{View}_{#1} \left( #2 \right)}}%
			{
				\IfValueTF{#1}%
					{\ensuremath{\algo{View}_{#1}}}%
					{\ensuremath{\algo{View}}}
			}%
	}%
}

\providecommand{\bigTheta}[1]{\ensuremath{\Theta \left( #1 \right)}}

\newcommand{\fromNtoM}[3]{\ensuremath{#1_#2, \ldots, #1_#3}}
\newcommand{\probability}[1]{\ensuremath{\textnormal{Pr}\left[ #1 \right]}} % chktex 35
\newcommand{\efficiency}[2]{\ensuremath{\left( \bigO{ #1 }, \ifthenelse{\equal{#2}{0}}{#2}{\bigO{ #2 }} \right)}}
\newcommand{\semitransp}[2][35]{\color{fg!#1}#2}

\newcommand{\BPlus}{B\raisebox{.35\height}{\scalebox{.8}{+}}}
\newcommand{\IO}{I/O}
\newcommand{\knn}{\ensuremath{k}NN}

\newtheorem{theorem}{Theorem}[section]
\newtheorem{claim}[theorem]{Claim}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{observation}[theorem]{Observation}
\newtheorem{fact}[theorem]{Fact}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{remark}[theorem]{Remark}
\newtheorem{example}[theorem]{Example}

% Add bidirectional arrow to cryptocode
\makeatletter
	\newcommandx*{\sendmessageboth}[2][1=<->]{%
		\sendmessage{#1}{#2}%
	}
	\WithSuffix\newcommand\sendmessageboth*[2][\pcdefaultmessagelength]{%
		\begingroup%
			\renewcommand{\@pcsendmessagetop}{\let\halign\@pc@halign$\begin{aligned}#2\end{aligned}$}% chktex 21
			\sendmessage{<->}{length=#1}%
		\endgroup%
	}
	\renewcommand{\pccomment}[1]{{\rhd\;\text{\scriptsize#1}}} % chktex 21
\makeatother

\newcommand{\pcinput}[1]{\textbf{Input:}\ #1}
\newcommand{\pcouput}[1]{\textbf{Output:}\ #1}

\definecolor{lightGrey}{RGB}{220,220,220}

% https://tex.stackexchange.com/a/1248/97712
% https://tex.stackexchange.com/a/268845/97712
\makeatletter
	\let\orgdescriptionlabel\descriptionlabel%
	\renewcommand*{\descriptionlabel}[1]{%
		\let\orglabel\label%
		\let\label\@gobble% chktex 21
		\phantomsection%
		\protected@edef\@currentlabel{#1\unskip}% chktex 21
		\let\label\orglabel
		\orgdescriptionlabel{#1}%
	}
\makeatother

% https://github.com/arnomi/cryptocode/issues/5
\AtBeginDocument{
	\pcfixhyperref%
	\makeatletter
		\crefformat{@pclinenumber}{line~#2#1#3}
		\Crefformat{@pclinenumber}{Line~#2#1#3}
		\crefrangeformat{@pclinenumber}{lines~#3#1#4 to~#5#2#6}
		\Crefrangeformat{@pclinenumber}{Lines~#3#1#4 to~#5#2#6}
	\makeatother
}

\newcommand{\domain}{\mathcal{D}}
\newcommand{\leak}{\mathcal{L}}
\newcommand{\setup}{\algo{KGen}}
\newcommand{\encrypt}{\algo{Enc}}
\newcommand{\compare}{\algo{Cmp}}
\newcommand{\tapegen}{\algo{TapeGen}}
\newcommand{\Csharp}{%
	{\settoheight{\dimen0}{C}C\kern-.05em \resizebox{!}{\dimen0}{\raisebox{\depth}{\#}}} % chktex 41
}
